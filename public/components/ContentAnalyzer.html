<!-- 파일 경로: public/components/ContentAnalyzer.html -->
<!-- Create at 2504271702 Ver1.54 -->

<div class="main-container">
  <div class="title-container">
    <h1>콘텐츠 상세분석기</h1>
  </div>

  <div class="form-card">
    <div class="input-row">
      <label class="form-label input-label">분석할 대상</label>
      <input
        type="text"
        id="inputValue"
        class="form-input"
        placeholder="YouTube URL을 입력하세요"
      />
      <button id="analyzeBtn" type="button" class="btn btn-primary">
        분석 시작
        <span id="spinner" class="spinner" style="display: none; margin-left: 8px;"></span>
      </button>
    </div>
    <div id="errorMessage" class="alert alert-danger" style="display: none; margin-top: 10px;"></div>
  </div>

  <div id="resultsContainer" class="content-container" style="display: none; margin-top: 20px;">
    <div style="margin-bottom: 15px;">
      <h2 id="videoTitle" style="margin-bottom: 5px;"></h2>
      <a id="videoUrl" href="#" target="_blank" style="color: var(--primary); display: none;">동영상 보기</a>
    </div>
    <div class="captions-container" style="max-height: 500px; overflow-y: auto; border: 1px solid #e5e7eb; padding: 15px; border-radius: 5px; background-color: #f9fafb;">
      <pre id="captionsOutput" style="white-space: pre-wrap; font-size: 14px; line-height: 1.6; margin: 0;"></pre>
    </div>
  </div>
</div>

<script>
// ContentAnalyzer 초기화 함수
function initializeContentAnalyzer() {
  const inputValue = document.getElementById('inputValue');
  const analyzeBtn = document.getElementById('analyzeBtn');
  const resultsContainer = document.getElementById('resultsContainer');

  // DOM 요소 확인
  if (!inputValue || !analyzeBtn || !resultsContainer) {
    console.error('ContentAnalyzer: 필요한 DOM 요소를 찾을 수 없습니다');
    return;
  }

  // 사용자 입력 현재값 검사 구문 수정
  function callHandleAnalyzeClick(event) {
    event.preventDefault();
    const value = inputValue.value.trim();
    if (value) {
      if (typeof window.handleAnalyzeClick === 'function') {
        window.handleAnalyzeClick();
      } else {
        console.error('ContentAnalyzer: 함수(handleAnalyzeClick)를 찾을 수 없습니다');
        alert('자막 추출 기능을 로드할 수 없습니다. 페이지를 새로고침 해보세요.');
      }
    }
  }

  // 이벤트 리스너 연결
  inputValue.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      callHandleAnalyzeClick(e);
    }
  });

  analyzeBtn.addEventListener('click', (e) => {
    callHandleAnalyzeClick(e);
  });
}

// ✅ 여기 추가!!!
window.handleAnalyzeClick = handleAnalyzeClick;

// 초기화 클래스 존재 검사 후 호출

document.addEventListener('DOMContentLoaded', () => {
  if (typeof window.initializeContentAnalyzer === 'function') {
    window.initializeContentAnalyzer();
  } else {
    console.warn('ContentAnalyzer 초기화 함수가 없습니다.');
  }
});

window.addEventListener('component-loaded', () => {
  if (typeof window.initializeContentAnalyzer === 'function') {
    window.initializeContentAnalyzer();
  }
});
</script>

<!-- 외부 JavaScript 파일 로드 -->
<script src="/js/contentAnalyzer.js"></script>